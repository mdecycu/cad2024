<!DOCTYPE html><html>
        <head>
        <title>cad2024</title>
        <meta charset="utf-8">
<meta property="head" content="H3">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/icomoon/style.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/magnific-popup.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/jquery-ui.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.carousel.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/aos.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/style.css">
        <link rel="shortcut icon" href="./../cmsimde/static/favicons.png">
        
        <style type='text/css'>
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body > div > div.dropdown.open {
                display: block;
            }
        </style>
    
        <!-- <script src="./../cmsimde/static/jquery.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/normalize.min.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch_set.js"></script>
        <script src="tipuesearch_content.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/tipuesearch.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch.js"></script>
        <!-- for Wink3 客製化關閉 -->
        <!--
        <link rel="stylesheet" type="text/css" href="./../cmsimde/static/winkPlayer.css" />
        <script type="text/javascript" src="./../cmsimde/static/winkPlayer.js"></script>
        -->
        <script>
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        </script>
        
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushHaxe.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPowerShell.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushMojo.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDart.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushRust.js"></script>
<link type="text/css" rel="stylesheet" href="./../cmsimde/static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 暫時不用
<script src="./../cmsimde/static/fengari-web.js"></script>
<script type="text/javascript" src="./../cmsimde/static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.add_border {
    border: 3px solid blue;
}
</style>

</head>
<body>
<div class='container'><nav>
        
    <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
    
            <header class="site-navbar py-4 bg-white" role="banner">
              <div class="container">
                <div class="row align-items-center">
                <h1>cad2024 電腦輔助設計與實習</h1>
                <div class="pl-4">
                    <form>
                    <input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required>
                    </form>
                </div>
                  <!-- <div class="col-11 col-xl-2">
                    <h1 class="mb-0 site-logo"><a href="index.html" class="text-black h2 mb-0">cad2024 電腦輔助設計與實習</a></h1> 
                  </div>
                  -->
                  <div class="col-12 col-md-10 d-none d-xl-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">
    <ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'>
                        <li class="active has-children"><a href="index.html">Home</a>
                        <ul class="dropdown">
                            <li><a href="sitemap.html">SMap</a></li>
                            <li><a href="./../reveal/index.html">reveal</a></li>
                            <li><a href="./../blog/index.html">blog</a></li>
                        </ul>
                      </li>
                     <li class='has-children'><a href='About.html'>About</a><ul class='dropdown'><li><a href='links.html'>links</a><li class='has-children'><a href='Site.html'>Site</a><ul class='dropdown'><li><a href='Pages.html'>Pages</a></li></ul><li><a href='Evaluate.html'>Evaluate</a><li><a href='Jupyter.html'>Jupyter</a><li><a href='Mechatronics.html'>Mechatronics</a><li><a href='Servers.html'>Servers</a><li><a href='Codespaces.html'>Codespaces</a></li></ul><li class='has-children'><a href='Topics.html'>Topics</a><ul class='dropdown'><li><a href='Topic 1.html'>Topic 1</a><li class='has-children'><a href='上課內容.html'>上課內容</a><ul class='dropdown'><li><a href='Seat.html'>Seat</a><li><a href='Vocabulary.html'>Vocabulary</a></li></ul><li><a href='Topic 2.html'>Topic 2</a><li class='has-children'><a href='Topic 3.html'>Topic 3</a><ul class='dropdown'><li><a href='lessons.html'>lessons</a><li><a href='STL.html'>STL</a><li><a href='NX_python.html'>NX_python</a></li></ul><li class='has-children'><a href='Topic 4.html'>Topic 4</a><ul class='dropdown'><li><a href='Pinball.html'>Pinball</a><li><a href='HW 3.html'>HW 3</a></li></li></ul></ul><li class='has-children'><a href='References.html'>References</a><ul class='dropdown'><li class='has-children'><a href='Parts.html'>Parts</a><ul class='dropdown'><li><a href='Solv_parts.html'>Solv_parts</a><li><a href='NX_parts.html'>NX_parts</a><li><a href='Exercises.html'>Exercises</a></li></ul><li><a href='BonW.html'>BonW</a><li><a href='Quadruped.html'>Quadruped</a><li><a href='Rover.html'>Rover</a><li><a href='meArm.html'>meArm</a></li></ul><li class='has-children'><a href='CAD.html'>CAD</a><ul class='dropdown'><li><a href='Q_AI.html'>Q_AI</a><li class='has-children'><a href='NX.html'>NX</a><ul class='dropdown'><li><a href='Ebooks.html'>Ebooks</a><li><a href='NX3.html'>NX3</a><li><a href='NX12.html'>NX12</a><li><a href='NX1872.html'>NX1872</a><li><a href='NX1980.html'>NX1980</a><li><a href='NX2008.html'>NX2008</a><li><a href='NX2312.html'>NX2312</a><li><a href='NX2406.html'>NX2406</a><li><a href='NXOpen.html'>NXOpen</a><li><a href='NXOpen_Python.html'>NXOpen_Python</a><li><a href='Open C.html'>Open C</a><li><a href='MSYS2.html'>MSYS2</a></li></ul><li><a href='Solvespace.html'>Solvespace</a><li class='has-children'><a href='CoppeliaSim.html'>CoppeliaSim</a><ul class='dropdown'><li><a href='ZMQ.html'>ZMQ</a></li></ul><li class='has-children'><a href='Webots.html'>Webots</a><ul class='dropdown'><li><a href='Webots_ex.html'>Webots_ex</a></li></ul><li><a href='SolidWorks.html'>SolidWorks</a></li></ul><li><a href='Python.html'>Python</a><li><a href='Project.html'>Project</a><li><a href='Brython.html'>Brython</a></li>
                      </ul>
                </nav>
              </div>
              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>
              </div>

            </div>
          </div>
          
        </header>
    <div id="tipue_search_content">CoppeliaSim << <a href='CoppeliaSim.html'>Previous</a> <a href='Webots.html'>Next</a> >> Webots<br /><h1>ZMQ</h1>
<p><a href="https://learning-0mq-with-pyzmq.readthedocs.io/en/latest/index.html">https://learning-0mq-with-pyzmq.readthedocs.io/en/latest/index.html</a></p>
<p style="padding-left: 30px;">ØMQ is a neat messaging library that allows you to build your own messaging infrastructure. ØMQ does not provide out of box messaging system experience like ActiveMQ or RabbitMQ. It is higher level concept than sockets and provides as low level conceptual framework as possible to build messaging systems. It can help build framework that scales where services could be handled by different applications that does one job well.</p>
<p style="padding-left: 30px;">Distributed applications are also easier to change compared to a monolithic applications. It’s expensive to try to define the behavior of each of many software applications that work together in a large network. It’s much cheaper, and more flexible, to define the interfaces between them: the APIs. Messaging is an API that can be stretched across a network.<br/><br/>ØMQ 是一個精簡的訊息傳遞程式庫 (messaging library)，允許使用者自行建立訊息傳遞基礎架構。ØMQ 不像 ActiveMQ 或 RabbitMQ 那樣提供開箱即用的訊息系統體驗。ØMQ 是比封包更高層級的概念，同時提供了儘可能低階的概念框架來構建訊息傳遞系統。它能夠幫助構建可擴展的框架 (framework)，使得這個框架中，不同的服務可以由專注於單一任務的獨立應用程式來處理。</p>
<p style="padding-left: 30px;">與單一應用程式相比，分散式應用程式更容易更改。嘗試定義在大型網路中協同工作的眾多軟體應用程式的行為，其成本很高; 定義它們之間的介面（API）要便宜得多，也更靈活。使得訊息傳遞是一種可以跨網路擴展的 API。</p>
<p>使用 pyzmq 建立程式範例:</p>
<p>server:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import zmq
import time

context = zmq.Context()
socket = context.socket(zmq.REP)
socket.bind("tcp://*:5555")

def process_request(request):
    # 模擬處理請求
    time.sleep(1)
    return f"已處理請求: {request}"

print("服務器已啟動，等待請求...")

while True:
    message = socket.recv_string()
    print(f"收到請求: {message}")
    
    response = process_request(message)
    
    socket.send_string(response)</pre>
<p>client:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import zmq

context = zmq.Context()
socket = context.socket(zmq.REQ)
socket.connect("tcp://localhost:5555")

for request in range(5):
    print(f"發送請求 {request}...")
    socket.send_string(f"請求 {request}")
    
    response = socket.recv_string()
    print(f"收到回覆: {response}")</pre>
<p>上列採用 pyzmq 模組的程式組合，主要展示 ZMQ 程式庫在兩個應用程式間負責傳遞訊息，其特性如下:<br/><br/>1. 通訊介面：<br/><br/>伺服器端和客戶端之間透過 ZMQ 定義了一個簡單的通訊介面。雙方不需要了解對方的內部運作，只需知道如何發送和接收訊息。<br/><br/>2. 跨網路的應用程式介面（API）：<br/><br/>使用 ZMQ 建立了一個可以跨網路運作的 API。伺服器和客戶端程式可以在不同的電腦上執行，只要能夠透過網路連線即可傳遞訊息。<br/><br/>3. 彈性：<br/><br/>使用者可以輕鬆修改伺服器的內部邏輯（例如: 變更用來處理請求的函式設計），而不需要更動客戶端的程式碼。<br/>同樣地，使用者也可以新增更多客戶端或甚至替換現有客戶端，只要客戶端程式遵循相同的訊息傳遞格式。<br/><br/>4. 成本效益：<br/><br/>定義這個簡單的訊息傳遞介面，比起詳細規劃每個應用程式的所有可能行為要簡單得多。<br/><br/>5. 可擴展性：<br/><br/>此一模型可以輕鬆擴展到更複雜的情境 (例如:新增多個伺服器、實現負載平衡等)，而基本的訊息傳遞模式可保持不變。</p>
<p>另外一組範例，以解二階微分方程為例：</p>
<p>y'' + p(x)y' + q(x)y = f(x), with boundary conditions y(a) = α and y(b) = β</p>
<p>可將問題範圍分割成多個子區間，每個工作者負責解決一個子區間。</p>
<p>首先，建立一個任務派送器：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># task_dispatcher.py
import zmq
import numpy as np
import time

def task_dispatcher():
    try:
        context = zmq.Context()
        task_sender = context.socket(zmq.PUSH)
        task_sender.bind("tcp://127.0.0.1:5557")
        print("Task sender bound to tcp://127.0.0.1:5557")

        result_receiver = context.socket(zmq.PULL)
        result_receiver.bind("tcp://127.0.0.1:5558")
        print("Result receiver bound to tcp://127.0.0.1:5558")

        print("Task dispatcher started. Waiting for workers to connect...")
        time.sleep(1)  # 給工作者一些時間來連接
        
        # 定義問題參數
        a, b = 0, 1  # 邊界
        alpha, beta = 0, 1  # 邊界條件
        N = 1000  # 總點數
        num_workers = 4  # 工作者數量

        h = (b - a) / (N - 1)  # 步長
        x = np.linspace(a, b, N)

        # 定義方程係數
        def p(x): return 1
        def q(x): return -2
        def f(x): return np.exp(-x)

        print("Dispatching tasks...")
        # 分配任務
        points_per_worker = N // num_workers
        for i in range(num_workers):
            start = i * points_per_worker
            end = (i + 1) * points_per_worker if i &lt; num_workers - 1 else N
            task = {
                'worker_id': i,
                'start': start,
                'end': end,
                'x': x[start:end].tolist(),
                'h': h,
                'p': [p(xi) for xi in x[start:end]],
                'q': [q(xi) for xi in x[start:end]],
                'f': [f(xi) for xi in x[start:end]]
            }
            task_sender.send_pyobj(task)
            print(f"Task sent to worker {i}")

        print("All tasks dispatched. Waiting for results...")

        # 收集結果
        results = [None] * num_workers
        for _ in range(num_workers):
            result = result_receiver.recv_pyobj()
            worker_id = result['worker_id']
            results[worker_id] = result['y']
            print(f"Received result from worker {worker_id}")

        # 組合結果
        y = np.concatenate(results)

        # 應用邊界條件
        y[0] = alpha
        y[-1] = beta

        print("Solution computed. First few values:", y[:5])
        print("Last few values:", y[-5:])

    except zmq.ZMQError as e:
        print(f"ZMQ Error occurred: {e}")
    except Exception as e:
        print(f"An unexpected error occurred: {e}")

if __name__ == "__main__":
    task_dispatcher()</pre>
<p>接著安排負責運算的 client 端程式:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># worker.py
import zmq
import numpy as np

def solve_segment(x, h, p, q, f):
    n = len(x)
    A = np.zeros((n, n))
    b = np.zeros(n)

    # 設置三對角矩陣
    for i in range(1, n-1):
        A[i, i-1] = 1 - h * p[i] / 2
        A[i, i] = -2 + h**2 * q[i]
        A[i, i+1] = 1 + h * p[i] / 2
        b[i] = h**2 * f[i]

    # 設置邊界條件（這裡使用自然邊界條件）
    A[0, 0] = A[-1, -1] = 1
    A[0, 1] = A[-1, -2] = -1

    return np.linalg.solve(A, b)

def worker(worker_id):
    context = zmq.Context()
    task_receiver = context.socket(zmq.PULL)
    task_receiver.connect("tcp://localhost:5557")

    result_sender = context.socket(zmq.PUSH)
    result_sender.connect("tcp://localhost:5558")

    print(f"Worker {worker_id} started. Waiting for task...")

    task = task_receiver.recv_pyobj()
    print(f"Worker {worker_id} received task")

    x = np.array(task['x'])
    h = task['h']
    p = np.array(task['p'])
    q = np.array(task['q'])
    f = np.array(task['f'])

    y = solve_segment(x, h, p, q, f)

    result = {
        'worker_id': worker_id,
        'y': y.tolist()
    }
    result_sender.send_pyobj(result)
    print(f"Worker {worker_id} sent result")

if __name__ == "__main__":
    import sys
    worker(int(sys.argv[1]) if len(sys.argv) &gt; 1 else 0)</pre>
<p>執行流程，先執行任務派送程式:</p>
<p>python task_dispatcher.py</p>
<p>然後在不同的終端中運行多個工作者：</p>
<p>python worker.py 0<br/>python worker.py 1<br/>python worker.py 2<br/>python worker.py 3</p>
<p>此一系統的工作原理:</p>
<ol>
<li>任務派發器將整個問題域分割成幾個子區間。</li>
<li>每個子區間的資料（包括 x 值、步長 h、方程式係數 p、q 和 f）被打包成一個任務，發送給工作者。</li>
<li>每個工作者接收一個子區間的任務，使用有限差分法解決該子區間的方程。</li>
<li>工作者將解決方案發送回任務派發器。</li>
<li>任務派發器收集所有工作者的結果，將它們組合成完整的解，並應用邊界條件。</li>
</ol>
<p>這個例子展示了如何使用 pyzmq 來實現一個分散式計算系統，用於解決複雜的數值問題。它將一個大問題分解成多個小問題，利用多台機器或多個處理器並行計算，從而提高計算效率。</p>
<p>注意：這個實現使用了自然邊界條件（Neumann邊界條件）來處理子區間的邊界。在實際應用中，可能需要根據具體問題調整邊界條件的處理方式。</p>
<p><a href="https://zx7978123.medium.com/%E8%AE%93%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0-%E7%A8%8B%E5%BC%8F-%E5%AE%B9%E5%99%A8%E5%8F%AF%E4%BB%A5%E4%BA%92%E7%9B%B8%E6%BA%9D%E9%80%9A%E6%96%B9%E6%B3%95-%E8%B6%85%E7%B0%A1%E5%96%AE%E7%9A%84zeromq-%E6%95%99%E5%AD%B8-407f7d17c23">Reference</a></p>
<br />CoppeliaSim << <a href='CoppeliaSim.html'>Previous</a> <a href='Webots.html'>Next</a> >> Webots</div>
        
    <!-- footer -->
      <div class="container">
        <div class="row pt-3 mx-auto">
            <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
        </div>
      </div>
    <!-- for footer -->
    
        </div> <!-- for site wrap -->
            <!-- <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script> -->
            <script src="../cmsimde/static/chimper/js/jquery-migrate-3.0.1.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery-ui.js"></script>
            <script src="../cmsimde/static/chimper/js/popper.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap.min.js"></script>
            <script src="../cmsimde/static/chimper/js/owl.carousel.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.stellar.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.countdown.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.magnific-popup.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap-datepicker.min.js"></script>
            <script src="../cmsimde/static/chimper/js/aos.js"></script>
            <!--
            <script src="../cmsimde/static/chimper/js/typed.js"></script>
                    <script>
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    </script>
            -->
            <script src="../cmsimde/static/chimper/js/main.js"></script>
        
<!-- 啟用 LaTeX equations 編輯 -->
  <!-- <script>
  MathJax = {
    tex: {inlineMath: [['$', '$'], ['\(', '\)']]}
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>-->
    </body></html>
        